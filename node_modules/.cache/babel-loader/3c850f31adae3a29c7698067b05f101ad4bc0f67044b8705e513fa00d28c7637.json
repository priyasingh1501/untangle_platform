{"ast":null,"code":"import{useState,useEffect}from'react';export const usePWA=()=>{const[isInstalled,setIsInstalled]=useState(false);const[isOnline,setIsOnline]=useState(navigator.onLine);const[showInstallPrompt,setShowInstallPrompt]=useState(false);const[deferredPrompt,setDeferredPrompt]=useState(null);const[registration,setRegistration]=useState(null);// Register service worker\nuseEffect(()=>{const isProd=process.env.NODE_ENV==='production';if(!isProd&&'serviceWorker'in navigator){navigator.serviceWorker.register('/sw.jsx').then(reg=>{console.log('✅ Service Worker registered successfully:',reg);setRegistration(reg);// Check if app is installed\nif(window.matchMedia('(display-mode: standalone)').matches){setIsInstalled(true);}}).catch(error=>{console.error('❌ Service Worker registration failed:',error);});}},[]);// Handle install prompt\nuseEffect(()=>{const handleBeforeInstallPrompt=e=>{console.log('📱 Install prompt triggered');e.preventDefault();setDeferredPrompt(e);setShowInstallPrompt(true);};const handleAppInstalled=()=>{console.log('✅ App installed successfully');setIsInstalled(true);setShowInstallPrompt(false);setDeferredPrompt(null);};// Listen for install prompt\nwindow.addEventListener('beforeinstallprompt',handleBeforeInstallPrompt);window.addEventListener('appinstalled',handleAppInstalled);return()=>{window.removeEventListener('beforeinstallprompt',handleBeforeInstallPrompt);window.removeEventListener('appinstalled',handleAppInstalled);};},[]);// Handle online/offline status\nuseEffect(()=>{const handleOnline=()=>{console.log('🌐 App is online');setIsOnline(true);};const handleOffline=()=>{console.log('📴 App is offline');setIsOnline(false);};window.addEventListener('online',handleOnline);window.addEventListener('offline',handleOffline);return()=>{window.removeEventListener('online',handleOnline);window.removeEventListener('offline',handleOffline);};},[]);// Install app function\nconst installApp=async()=>{if(deferredPrompt){console.log('📱 Installing app...');deferredPrompt.prompt();const{outcome}=await deferredPrompt.userChoice;console.log('📱 Install outcome:',outcome);if(outcome==='accepted'){setIsInstalled(true);}setDeferredPrompt(null);setShowInstallPrompt(false);}};// Update app function\nconst updateApp=()=>{if(registration){registration.update();}};// Send message to service worker\nconst sendMessageToSW=message=>{if(registration&&registration.active){registration.active.postMessage(message);}};return{isInstalled,isOnline,showInstallPrompt,installApp,updateApp,sendMessageToSW,registration};};","map":{"version":3,"names":["useState","useEffect","usePWA","isInstalled","setIsInstalled","isOnline","setIsOnline","navigator","onLine","showInstallPrompt","setShowInstallPrompt","deferredPrompt","setDeferredPrompt","registration","setRegistration","isProd","process","env","NODE_ENV","serviceWorker","register","then","reg","console","log","window","matchMedia","matches","catch","error","handleBeforeInstallPrompt","e","preventDefault","handleAppInstalled","addEventListener","removeEventListener","handleOnline","handleOffline","installApp","prompt","outcome","userChoice","updateApp","update","sendMessageToSW","message","active","postMessage"],"sources":["/Users/priyas/Desktop/untangle-platform/src/hooks/usePWA.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\n\nexport const usePWA = () => {\n  const [isInstalled, setIsInstalled] = useState(false);\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [showInstallPrompt, setShowInstallPrompt] = useState(false);\n  const [deferredPrompt, setDeferredPrompt] = useState(null);\n  const [registration, setRegistration] = useState(null);\n\n  // Register service worker\n  useEffect(() => {\n    const isProd = process.env.NODE_ENV === 'production';\n    if (!isProd && 'serviceWorker' in navigator) {\n      navigator.serviceWorker\n        .register('/sw.jsx')\n        .then((reg) => {\n          console.log('✅ Service Worker registered successfully:', reg);\n          setRegistration(reg);\n          \n          // Check if app is installed\n          if (window.matchMedia('(display-mode: standalone)').matches) {\n            setIsInstalled(true);\n          }\n        })\n        .catch((error) => {\n          console.error('❌ Service Worker registration failed:', error);\n        });\n    }\n  }, []);\n\n  // Handle install prompt\n  useEffect(() => {\n    const handleBeforeInstallPrompt = (e) => {\n      console.log('📱 Install prompt triggered');\n      e.preventDefault();\n      setDeferredPrompt(e);\n      setShowInstallPrompt(true);\n    };\n\n    const handleAppInstalled = () => {\n      console.log('✅ App installed successfully');\n      setIsInstalled(true);\n      setShowInstallPrompt(false);\n      setDeferredPrompt(null);\n    };\n\n    // Listen for install prompt\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, []);\n\n  // Handle online/offline status\n  useEffect(() => {\n    const handleOnline = () => {\n      console.log('🌐 App is online');\n      setIsOnline(true);\n    };\n\n    const handleOffline = () => {\n      console.log('📴 App is offline');\n      setIsOnline(false);\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  // Install app function\n  const installApp = async () => {\n    if (deferredPrompt) {\n      console.log('📱 Installing app...');\n      deferredPrompt.prompt();\n      \n      const { outcome } = await deferredPrompt.userChoice;\n      console.log('📱 Install outcome:', outcome);\n      \n      if (outcome === 'accepted') {\n        setIsInstalled(true);\n      }\n      \n      setDeferredPrompt(null);\n      setShowInstallPrompt(false);\n    }\n  };\n\n  // Update app function\n  const updateApp = () => {\n    if (registration) {\n      registration.update();\n    }\n  };\n\n  // Send message to service worker\n  const sendMessageToSW = (message) => {\n    if (registration && registration.active) {\n      registration.active.postMessage(message);\n    }\n  };\n\n  return {\n    isInstalled,\n    isOnline,\n    showInstallPrompt,\n    installApp,\n    updateApp,\n    sendMessageToSW,\n    registration\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}