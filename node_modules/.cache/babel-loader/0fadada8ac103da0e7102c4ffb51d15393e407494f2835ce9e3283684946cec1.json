{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect,useCallback}from'react';import axios from'axios';import toast from'react-hot-toast';import{buildApiUrl}from'../config';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[token,setToken]=useState(localStorage.getItem('token'));const fetchUserProfile=useCallback(async()=>{try{const token=localStorage.getItem('token');if(!token){console.log('ðŸ” No token found, skipping profile fetch');setLoading(false);return;}console.log('ðŸ” Fetching profile with token:',token.substring(0,20)+'...');const response=await axios.get(buildApiUrl('/api/auth/profile'));setUser(response.data.user);}catch(error){var _error$response,_error$response2,_error$response3;console.error('Error fetching user profile:',error);console.error('Error status:',error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status);console.error('Error data:',error===null||error===void 0?void 0:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data);// If unauthorized, try to refresh token once before logging out\nif((error===null||error===void 0?void 0:(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===401){console.log('ðŸ” 401 error, attempting token refresh...');try{const refreshResult=await refreshToken();if(refreshResult.success){console.log('ðŸ” Token refresh successful, retrying profile fetch');const retryResponse=await axios.get(buildApiUrl('/api/auth/profile'));setUser(retryResponse.data.user);}else{console.log('ðŸ” Token refresh failed, logging out');logout();}}catch(refreshError){console.error('Profile fetch: token refresh failed:',refreshError);logout();}}else{// For non-401 errors, just log out\nconsole.log('ðŸ” Non-401 error, logging out');logout();}}finally{setLoading(false);}},[]);const logout=useCallback(()=>{setUser(null);setToken(null);localStorage.removeItem('token');localStorage.removeItem('refreshToken');delete axios.defaults.headers.common['Authorization'];toast.success('Logged out successfully');},[]);// Configure axios defaults\nuseEffect(()=>{if(token){axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);fetchUserProfile();}else{setLoading(false);}},[token,fetchUserProfile]);const login=async(email,password)=>{try{var _responseData$tokens,_responseData$tokens2,_responseData$tokens3;const response=await axios.post(buildApiUrl('/api/auth/login'),{email,password});console.log('ðŸ” Login response:',response.data);// Extract tokens with multiple fallback strategies\nconst responseData=response.data;let accessToken=null;let refreshToken=null;// Strategy 1: Direct token field\nif(responseData.token){accessToken=responseData.token;console.log('ðŸ” Found token in responseData.token');}// Strategy 2: tokens.accessToken\nif(!accessToken&&(_responseData$tokens=responseData.tokens)!==null&&_responseData$tokens!==void 0&&_responseData$tokens.accessToken){accessToken=responseData.tokens.accessToken;console.log('ðŸ” Found token in responseData.tokens.accessToken');}// Strategy 3: tokens.token\nif(!accessToken&&(_responseData$tokens2=responseData.tokens)!==null&&_responseData$tokens2!==void 0&&_responseData$tokens2.token){accessToken=responseData.tokens.token;console.log('ðŸ” Found token in responseData.tokens.token');}// Get refresh token\nif((_responseData$tokens3=responseData.tokens)!==null&&_responseData$tokens3!==void 0&&_responseData$tokens3.refreshToken){refreshToken=responseData.tokens.refreshToken;console.log('ðŸ” Found refresh token');}console.log('ðŸ” Final accessToken:',accessToken);console.log('ðŸ” Final refreshToken:',refreshToken);// Validate we have a token\nif(!accessToken){console.error('âŒ No access token found in response:',responseData);throw new Error('No access token received from server');}// Store tokens immediately\nlocalStorage.setItem('token',accessToken);if(refreshToken){localStorage.setItem('refreshToken',refreshToken);}// Set axios default header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(accessToken);// Update state\nsetToken(accessToken);setUser(responseData.user);console.log('ðŸ” Token stored in localStorage:',localStorage.getItem('token'));console.log('ðŸ” Refresh token stored:',localStorage.getItem('refreshToken'));toast.success('Login successful!');return{success:true};}catch(error){var _error$response4,_error$response4$data;console.error('âŒ Login error:',error);const message=((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||error.message||'Login failed';toast.error(message);return{success:false,message};}};const register=async userData=>{try{const response=await axios.post(buildApiUrl('/api/auth/register'),userData);const{token:newToken,user:newUser,tokens}=response.data;const accessToken=newToken||(tokens===null||tokens===void 0?void 0:tokens.accessToken)||(tokens===null||tokens===void 0?void 0:tokens.token);const refreshToken=tokens===null||tokens===void 0?void 0:tokens.refreshToken;setToken(accessToken);setUser(newUser);localStorage.setItem('token',accessToken);if(refreshToken){localStorage.setItem('refreshToken',refreshToken);}axios.defaults.headers.common['Authorization']=\"Bearer \".concat(accessToken);toast.success('Registration successful!');return{success:true};}catch(error){var _error$response5,_error$response5$data;const message=((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||error.message||'Registration failed';toast.error(message);return{success:false,message};}};const updateProfile=async updates=>{try{const response=await axios.put(buildApiUrl('/api/auth/profile'),updates);setUser(response.data.user);toast.success('Profile updated successfully');return{success:true};}catch(error){var _error$response6,_error$response6$data;const message=((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.message)||'Profile update failed';toast.error(message);return{success:false,message};}};const changePassword=async(currentPassword,newPassword)=>{try{await axios.put(buildApiUrl('/api/auth/change-password'),{currentPassword,newPassword});toast.success('Password changed successfully');return{success:true};}catch(error){var _error$response7,_error$response7$data;const message=((_error$response7=error.response)===null||_error$response7===void 0?void 0:(_error$response7$data=_error$response7.data)===null||_error$response7$data===void 0?void 0:_error$response7$data.message)||'Password change failed';toast.error(message);return{success:false,message};}};const refreshToken=async()=>{try{const storedRefreshToken=localStorage.getItem('refreshToken');if(!storedRefreshToken){logout();return{success:false};}const response=await axios.post(buildApiUrl('/api/auth/refresh'),{refreshToken:storedRefreshToken});const{tokens}=response.data;const newToken=tokens.accessToken||tokens.token;const newRefreshToken=tokens.refreshToken;setToken(newToken);localStorage.setItem('token',newToken);if(newRefreshToken){localStorage.setItem('refreshToken',newRefreshToken);}axios.defaults.headers.common['Authorization']=\"Bearer \".concat(newToken);return{success:true};}catch(error){console.error('Token refresh failed:',error);logout();return{success:false};}};// Add axios interceptor for automatic token refresh\nuseEffect(()=>{const interceptor=axios.interceptors.response.use(response=>response,async error=>{var _error$response8;if(((_error$response8=error.response)===null||_error$response8===void 0?void 0:_error$response8.status)===401&&token){// Token expired, try to refresh\nconst refreshResult=await refreshToken();if(refreshResult.success){// Retry the original request with the new token\nconst originalRequest=error.config;const newToken=localStorage.getItem('token');originalRequest.headers['Authorization']=\"Bearer \".concat(newToken);return axios(originalRequest);}}return Promise.reject(error);});return()=>{axios.interceptors.response.eject(interceptor);};},[token]);const value={user,loading,token,login,register,logout,updateProfile,changePassword,refreshToken,isAuthenticated:!!user};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","axios","toast","buildApiUrl","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","setToken","localStorage","getItem","fetchUserProfile","console","log","substring","response","get","data","error","_error$response","_error$response2","_error$response3","status","refreshResult","refreshToken","success","retryResponse","logout","refreshError","removeItem","defaults","headers","common","concat","login","email","password","_responseData$tokens","_responseData$tokens2","_responseData$tokens3","post","responseData","accessToken","tokens","setItem","_error$response4","_error$response4$data","message","register","userData","newToken","newUser","_error$response5","_error$response5$data","updateProfile","updates","put","_error$response6","_error$response6$data","changePassword","currentPassword","newPassword","_error$response7","_error$response7$data","storedRefreshToken","newRefreshToken","interceptor","interceptors","use","_error$response8","originalRequest","config","Promise","reject","eject","value","isAuthenticated","Provider"],"sources":["/Users/priyas/Desktop/untangle-platform/src/contexts/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\nimport { buildApiUrl } from '../config';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState(localStorage.getItem('token'));\n\n  const fetchUserProfile = useCallback(async () => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        console.log('ðŸ” No token found, skipping profile fetch');\n        setLoading(false);\n        return;\n      }\n      \n      console.log('ðŸ” Fetching profile with token:', token.substring(0, 20) + '...');\n      const response = await axios.get(buildApiUrl('/api/auth/profile'));\n      setUser(response.data.user);\n    } catch (error) {\n      console.error('Error fetching user profile:', error);\n      console.error('Error status:', error?.response?.status);\n      console.error('Error data:', error?.response?.data);\n      \n      // If unauthorized, try to refresh token once before logging out\n      if (error?.response?.status === 401) {\n        console.log('ðŸ” 401 error, attempting token refresh...');\n        try {\n          const refreshResult = await refreshToken();\n          if (refreshResult.success) {\n            console.log('ðŸ” Token refresh successful, retrying profile fetch');\n            const retryResponse = await axios.get(buildApiUrl('/api/auth/profile'));\n            setUser(retryResponse.data.user);\n          } else {\n            console.log('ðŸ” Token refresh failed, logging out');\n            logout();\n          }\n        } catch (refreshError) {\n          console.error('Profile fetch: token refresh failed:', refreshError);\n          logout();\n        }\n      } else {\n        // For non-401 errors, just log out\n        console.log('ðŸ” Non-401 error, logging out');\n        logout();\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const logout = useCallback(() => {\n    setUser(null);\n    setToken(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('refreshToken');\n    delete axios.defaults.headers.common['Authorization'];\n    toast.success('Logged out successfully');\n  }, []);\n\n  // Configure axios defaults\n  useEffect(() => {\n    if (token) {\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      fetchUserProfile();\n    } else {\n      setLoading(false);\n    }\n  }, [token, fetchUserProfile]);\n\n  const login = async (email, password) => {\n    try {\n      const response = await axios.post(buildApiUrl('/api/auth/login'), { email, password });\n      \n      console.log('ðŸ” Login response:', response.data);\n      \n      // Extract tokens with multiple fallback strategies\n      const responseData = response.data;\n      let accessToken = null;\n      let refreshToken = null;\n      \n      // Strategy 1: Direct token field\n      if (responseData.token) {\n        accessToken = responseData.token;\n        console.log('ðŸ” Found token in responseData.token');\n      }\n      \n      // Strategy 2: tokens.accessToken\n      if (!accessToken && responseData.tokens?.accessToken) {\n        accessToken = responseData.tokens.accessToken;\n        console.log('ðŸ” Found token in responseData.tokens.accessToken');\n      }\n      \n      // Strategy 3: tokens.token\n      if (!accessToken && responseData.tokens?.token) {\n        accessToken = responseData.tokens.token;\n        console.log('ðŸ” Found token in responseData.tokens.token');\n      }\n      \n      // Get refresh token\n      if (responseData.tokens?.refreshToken) {\n        refreshToken = responseData.tokens.refreshToken;\n        console.log('ðŸ” Found refresh token');\n      }\n      \n      console.log('ðŸ” Final accessToken:', accessToken);\n      console.log('ðŸ” Final refreshToken:', refreshToken);\n      \n      // Validate we have a token\n      if (!accessToken) {\n        console.error('âŒ No access token found in response:', responseData);\n        throw new Error('No access token received from server');\n      }\n      \n      // Store tokens immediately\n      localStorage.setItem('token', accessToken);\n      if (refreshToken) {\n        localStorage.setItem('refreshToken', refreshToken);\n      }\n      \n      // Set axios default header\n      axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n      \n      // Update state\n      setToken(accessToken);\n      setUser(responseData.user);\n      \n      console.log('ðŸ” Token stored in localStorage:', localStorage.getItem('token'));\n      console.log('ðŸ” Refresh token stored:', localStorage.getItem('refreshToken'));\n      \n      toast.success('Login successful!');\n      return { success: true };\n    } catch (error) {\n      console.error('âŒ Login error:', error);\n      const message = error.response?.data?.message || error.message || 'Login failed';\n      toast.error(message);\n      return { success: false, message };\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      const response = await axios.post(buildApiUrl('/api/auth/register'), userData);\n      \n      const { token: newToken, user: newUser, tokens } = response.data;\n      const accessToken = newToken || tokens?.accessToken || tokens?.token;\n      const refreshToken = tokens?.refreshToken;\n      \n      setToken(accessToken);\n      setUser(newUser);\n      localStorage.setItem('token', accessToken);\n      if (refreshToken) {\n        localStorage.setItem('refreshToken', refreshToken);\n      }\n      axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n      \n      toast.success('Registration successful!');\n      return { success: true };\n    } catch (error) {\n      const message = error.response?.data?.message || error.message || 'Registration failed';\n      toast.error(message);\n      return { success: false, message };\n    }\n  };\n\n  const updateProfile = async (updates) => {\n    try {\n      const response = await axios.put(buildApiUrl('/api/auth/profile'), updates);\n      setUser(response.data.user);\n      toast.success('Profile updated successfully');\n      return { success: true };\n    } catch (error) {\n      const message = error.response?.data?.message || 'Profile update failed';\n      toast.error(message);\n      return { success: false, message };\n    }\n  };\n\n  const changePassword = async (currentPassword, newPassword) => {\n    try {\n      await axios.put(buildApiUrl('/api/auth/change-password'), { currentPassword, newPassword });\n      toast.success('Password changed successfully');\n      return { success: true };\n    } catch (error) {\n      const message = error.response?.data?.message || 'Password change failed';\n      toast.error(message);\n      return { success: false, message };\n    }\n  };\n\n\n  const refreshToken = async () => {\n    try {\n      const storedRefreshToken = localStorage.getItem('refreshToken');\n      if (!storedRefreshToken) {\n        logout();\n        return { success: false };\n      }\n\n      const response = await axios.post(buildApiUrl('/api/auth/refresh'), {\n        refreshToken: storedRefreshToken\n      });\n      \n      const { tokens } = response.data;\n      const newToken = tokens.accessToken || tokens.token;\n      const newRefreshToken = tokens.refreshToken;\n      \n      setToken(newToken);\n      localStorage.setItem('token', newToken);\n      if (newRefreshToken) {\n        localStorage.setItem('refreshToken', newRefreshToken);\n      }\n      axios.defaults.headers.common['Authorization'] = `Bearer ${newToken}`;\n      \n      return { success: true };\n    } catch (error) {\n      console.error('Token refresh failed:', error);\n      logout();\n      return { success: false };\n    }\n  };\n\n  // Add axios interceptor for automatic token refresh\n  useEffect(() => {\n    const interceptor = axios.interceptors.response.use(\n      (response) => response,\n      async (error) => {\n        if (error.response?.status === 401 && token) {\n          // Token expired, try to refresh\n          const refreshResult = await refreshToken();\n          if (refreshResult.success) {\n            // Retry the original request with the new token\n            const originalRequest = error.config;\n            const newToken = localStorage.getItem('token');\n            originalRequest.headers['Authorization'] = `Bearer ${newToken}`;\n            return axios(originalRequest);\n          }\n        }\n        return Promise.reject(error);\n      }\n    );\n\n    return () => {\n      axios.interceptors.response.eject(interceptor);\n    };\n  }, [token]);\n\n  const value = {\n    user,\n    loading,\n    token,\n    login,\n    register,\n    logout,\n    updateProfile,\n    changePassword,\n    refreshToken,\n    isAuthenticated: !!user,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}